
// -- user code here --

/* --- start generated code --- */

// Generated by  1.5.2 (Phaser v2.6.2)


/**
 * Level.
 */
function Level() {
	
	Phaser.State.call(this);
	
}

/** @type Phaser.State */
var Level_proto = Object.create(Phaser.State.prototype);
Level.prototype = Level_proto;
Level.prototype.constructor = Level;

Level.prototype.init = function () {
	
	this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
	this.scale.pageAlignHorizontally = true;
	this.scale.pageAlignVertically = true;
	this.stage.backgroundColor = '#ffffff';
	
};

Level.prototype.preload = function () {
	
	this.load.pack('maze', 'assets/pack.json');
	
};

Level.prototype.create = function () {
	
	this.initScene();
	this.world.setBounds(0, 0, 20000, 20000);
	this.cursors = this.input.keyboard.createCursorKeys();
	
	var _bottomLayer = this.add.tilemap('bottomLayer', 32, 32);
	_bottomLayer.addTilesetImage('base_out_atlas1');
	var _bottomLayer_layer = _bottomLayer.createLayer(0);
	_bottomLayer_layer.resizeWorld();
	
	var _MidLayer = this.add.tilemap('MidLayer', 32, 32);
	_MidLayer.addTilesetImage('terrain_atlas1');
	var _MidLayer_layer = _MidLayer.createLayer(0);
	_MidLayer_layer.resizeWorld();
	
	var _BlockLayer = this.add.tilemap('BlockLayer', 32, 32);
	_BlockLayer.addTilesetImage('base_out_atlas1');
	_BlockLayer.setCollision([38]);
	var _BlockLayer_layer = _BlockLayer.createLayer(0);
	_BlockLayer_layer.resizeWorld();
	
	var _player = this.add.sprite(83.0, 27.0, 'atlas', 'misa-front-walk.000');
	_player.animations.add('Back', ['misa-back-walk.000', 'misa-back-walk.001', 'misa-back-walk.002', 'misa-back-walk.003'], 6, true);
	_player.animations.add('Left', ['misa-left-walk.000', 'misa-left-walk.001', 'misa-left-walk.002', 'misa-left-walk.003'], 6, true);
	_player.animations.add('Front', ['misa-front-walk.000', 'misa-front-walk.001', 'misa-front-walk.002', 'misa-front-walk.003'], 6, true);
	_player.animations.add('Right', ['misa-right-walk.000', 'misa-right-walk.001', 'misa-right-walk.002', 'misa-right-walk.003'], 6, true);
	_player.animations.add('BackStay', ['misa-back'], 6, false);
	_player.animations.add('FrontStay', ['misa-front'], 6, false);
	_player.animations.add('LeftStay', ['misa-left'], 6, false);
	_player.animations.add('RightStay', ['misa-right'], 6, false);
	this.game.physics.arcade.enable(_player);
	_player.body.setSize(32.0, 32.0, 0.0, 32.0);
	
	var _Hole = this.add.group();
	
	this.add.sprite(512.0, 416.0, 'base_out_atlas', 161, _Hole);
	
	this.add.sprite(544.0, 416.0, 'base_out_atlas', 162, _Hole);
	
	var _Hole2 = this.add.sprite(544.0, 448.0, 'base_out_atlas', 194, _Hole);
	
	var _Hole1 = this.add.sprite(512.0, 448.0, 'base_out_atlas', 193, _Hole);
	
	this.add.sprite(544.0, 480.0, 'base_out_atlas', 226, _Hole);
	
	this.add.sprite(512.0, 480.0, 'base_out_atlas', 225, _Hole);
	
	var _monster = this.add.sprite(641.0, 520.0, 'monster', 'sprite1');
	var _monster_Auto = _monster.animations.add('Auto', ['sprite1', 'sprite2', 'sprite6'], 2, true);
	_monster_Auto.play();
	this.game.physics.arcade.enable(_monster);
	
	
	
	// fields
	
	this.fBottomLayer = _bottomLayer;
	this.fBottomLayer_layer = _bottomLayer_layer;
	this.fMidLayer = _MidLayer;
	this.fMidLayer_layer = _MidLayer_layer;
	this.fBlockLayer = _BlockLayer;
	this.fBlockLayer_layer = _BlockLayer_layer;
	this.fPlayer = _player;
	this.fHole = _Hole;
	this.fHole2 = _Hole2;
	this.fHole1 = _Hole1;
	this.fMonster = _monster;
	//this.camera.follow(this.fPlayer);
	if (game1Pass){
		this.fPlayer.x = playerX;
		this.fPlayer.y = playerY;
		this.fMonster.visible = false;
	}
	
};

/* --- end generated code --- */
var map;
Level.prototype.initScene = function () {
    
};
Level.prototype.update = function () {
	
	//if (checkOverlap(this.fPlayer,this.fBase_out_atlas2)&&!IsIn){
		//state = this.game.state.getCurrentState();
		//localStorage.setItem ('state',this.game.state.getCurrentState());
	if((checkOverlap(this.fPlayer,this.fHole2)||checkOverlap(this.fPlayer,this.fHole1))){
		this.state.add("Level2", Level2);
		this.state.start("Level2");
	}
	if(checkOverlap(this.fPlayer,this.fMonster)&&!game1Pass){
		playerX = this.fPlayer.x;
		playerY = this.fPlayer.y;
		this.state.add("game1", game1);
		this.state.start("game1");
	}
	this.physics.arcade.collide(this.fPlayer, this.fBlockLayer_layer);
	this.fPlayer.body.velocity.set(0);
    if (this.cursors.left.isDown|| goToTheLeft)
    {
    	// move to the left
    	this.fPlayer.play('Left');
    	this.fPlayer.body.velocity.x -= 200;
    	play = 'LeftStay';
        
    }else if (this.cursors.right.isDown|| goToTheRight)
    {
    	// move to the right
    	this.fPlayer.play('Right');
    	this.fPlayer.body.velocity.x += 200;
    	play = 'RightStay';
    }
    else  if (this.cursors.up.isDown|| goToTheUp)
    {
    	// move to the up
    	this.fPlayer.play('Back');
    	this.fPlayer.body.velocity.y -= 200;
    	play = 'BackStay';
    }else if (this.cursors.down.isDown|| goToTheDown)
    {
    	// move to the down
    	this.fPlayer.play('Front');
    	this.fPlayer.body.velocity.y += 200;
    	play = 'FrontStay';
    }else{
    	this.fPlayer.play(play);
    }

};



function checkOverlap(spriteA, spriteB) {
 
    var boundsA = spriteA.getBounds();
    var boundsB = spriteB.getBounds();              
 
    return Phaser.Rectangle.intersects(boundsA, boundsB);
 
}
 
// -- user code here --
var goToTheRight = false;
var goToTheLeft = false;
var goToTheUp = false;
var goToTheDown = false;
var play;
var playerY;
var playerX;
